<!DOCTYPE html>
<style>
h1 {
  font-family: sans-serif;
}
#postWarning {
  color: red;
}
textarea {
  width: calc(100%% - 10px);
  height: 50vh;
}
</style>

<h1>Chromium CQ Status</h1>
<pre>
Source code:
<a href="https://chromium.googlesource.com/infra/infra/+/master/appengine_apps/chromium_cq_status/">https://chromium.googlesource.com/infra/infra/+/master/appengine_apps/chromium_cq_status/</a>
Use "<a href="http://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html">fetch</a> infra" to clone the dev repos.



Site directory listing:

&gt;&gt;&gt; <a href="/recent">/recent</a>
Shows a table of recently received records.
Tags to filter by are specified as a comma separated list after the #.
Example: <a href="/recent#project=chromium,action=patch_start">/recent#project=chromium,action=patch_start</a>


&gt;&gt;&gt; <a href="/patch-status/<issue>/<patchset>">/patch-status/&lt;issue&gt;/&lt;patchset&gt;</a>
Shows a timeline of CQ activity on a given patch.
Only accepts GET requests.
Example: <a href="/patch-status/557043002/1">/patch-status/557043002/1</a>


&gt;&gt;&gt; <a href="/stats/<project>/(15-minutely|hourly|daily|weekly)">/stats/&lt;project&gt;/(15-minutely|hourly|daily|weekly)</a>
Recent CQ stats for a project aggregated by various time intervals.
Only accepts GET requests.
Accepts optional URL param for how many data points to fetch:
  data_points: int

Examples:
<a href="/stats/chromium/15-minutely">/stats/chromium/15-minutely</a>
<a href="/stats/chromium/hourly">/stats/chromium/hourly</a>
<a href="/stats/chromium/daily">/stats/chromium/daily</a>
<a href="/stats/chromium/weekly">/stats/chromium/weekly</a>

<a href="/stats/blink/15-minutely">/stats/blink/15-minutely</a>
<a href="/stats/blink/hourly">/stats/blink/hourly</a>
<a href="/stats/blink/daily">/stats/blink/daily</a>
<a href="/stats/blink/weekly">/stats/blink/weekly</a>


&gt;&gt;&gt; <a href="/stats/query">/stats/query</a>
API for querying CQ stats.
Only accepts GET requests.
Accepts the following optional URL params:
  project: str
  interval_minutes: int
  begin: timestamp
  end: timestamp
  names: str (comma separated globs where * and ? are permitted for fuzzy matching)
  count: int=100 (max 1000)
  cursor: str=''

The returned query results are in the following JSON structure:
{
  "results": [
    {
      "key": int,
      "project": str,
      "interval_minutes": int,
      "begin": timestamp,
      "end": timestamp,
      "stats": [
        {
          "type": "count",
          "name": str,
          "description": str,
          "count": int
        }
        OR
        {
          "type": "list",
          "name": str,
          "description": str,
          "unit": str,
          "sample_size": int,
          "min": float,
          "max": float,
          "mean": float,
          "percentile_10": float,
          "percentile_25": float,
          "percentile_50": float,
          "percentile_75": float,
          "percentile_90": float,
          "percentile_95": float,
          "percentile_99": float
        }
      ]
    }
  ],
  "cursor": str,
  "more": bool
}

Example: <a href="/stats/query?project=chromium&names=issue-count,patchset-*&count=1">/stats/query?project=chromium&names=issue-count,patchset-*&count=1</a>

The "key" parameter can be used to query the lowest/highest data points in individual stats.


&gt;&gt;&gt; <a href="/stats/(highest|lowest)/<list stats name>/<CQ stats key>">/stats/(highest|lowest)/&lt;list stats name&gt;/&lt;CQ stats key&gt;</a>
API for querying highest/lowest data points in individual stats.
Only accepts GET requests.
Data points are returned in the following JSON structure:
[
  [
    float,
    {data point metadata}
  ]
]
The highest data points are given in descending order.
The lowest data points are given in ascending order.
Data point metadata is typically of the form:
{
  "issue": int,
  "patchset": int
}

Examples:
<a href="/stats/highest/attempt-durations/6361816489787392">/stats/highest/attempt-durations/6361816489787392</a>
<a href="/stats/lowest/attempt-durations/6361816489787392">/stats/lowest/attempt-durations/6361816489787392</a>


&gt;&gt;&gt; <a href="/query">/query</a>
API for querying CQ records.
Only accepts GET requests.
Accepts the following optional URL params:
  key: str (non numeric)
  begin: timestamp
  end: timestamp
  tags: str (comma separated)
  fields: json
  count: int=100 (max 1000)
  cursor: str

The returned query results are in the following JSON structure:
{
  "results": [{
    "timestamp": int,
    "key": str|null,
    "tags": [str],
    "fields": {field: value}
  }],
  "more": bool,
  "cursor": str
}

Example:
<a href="/query?tags=project%%3Dchromium,action%%3Dpatch_start&count=10">/query?tags=project%%3Dchromium,action%%3Dpatch_start&count=10</a> shows the 10 most recently started CQ attempts.

Shortcut:
Tags can be specified in the URL, the following is an equivalent example.
<a href="/query/project=chromium/action=patch_start?count=10">/query/project=chromium/action=patch_start?count=10</a>


&gt;&gt;&gt; <a href="/post">/post</a>
API for posting CQ records.
Requires @chromium.org/@google.com <a href="%(login_url)s">sign in</a>.
Only accepts POST requests.
Accepts multiple p URL params.
Each p value is a record to add in the following JSON structure:
{
  "key": str|null,
  "tags": [str],
  "fields": {field: value}
}



TESTING ONLY:
<form id="queryForm">
Query entries from /query:
  key: <input type="textbox" name="key">
  begin: <input type="textbox" name="begin">
  end: <input type="textbox" name="end">
  tags: <input type="textbox" name="tags">
  fields: <input type="textbox" name="fields">
  count: <input type="textbox" name="count">
  cursor: <input type="textbox" name="cursor">
  <input type="reset" value="Clear"> <input type="button" id="querySubmit" value="Query">
</form>
Query view:
<textarea id="queryResult"></textarea>

<form id="postForm">
Post entry to /post:
  key: <input type="textbox" name="key">
  tags: <input type="textbox" name="tags">
  fields: <input type="textbox" name="fields">
  <input type="reset" value="Clear"> <input type="button" id="postSubmit" value="Post"> <span id="postWarning"></span>
Post result:
<textarea id="postResult"></textarea>
</form>
</pre>

<script>
if (!%(valid_user)d) {
  postWarning.textContent = 'Posting restricted to @chromium.org/@google.com users.';
  postSubmit.disabled = true;
}

function encodeForm(form) {
  return [].map.call(form.querySelectorAll('input[type=textbox]'), function(field) {
    return field.name + '=' + encodeURIComponent(field.value);
  }).join('&');
}

function loadResult(url, textarea) {
  textarea.value = '';
  var xhr = new XMLHttpRequest();
  xhr.open('get', url, true);
  xhr.onreadystatechange = function() {
    if (xhr.readyState === XMLHttpRequest.DONE) {
      try {
        var json = JSON.parse(xhr.responseText);
        textarea.value = JSON.stringify(json, null, '  ')
      } catch (_) {
        textarea.value = xhr.responseText;
      }
    }
  }
  xhr.send();
}

postSubmit.addEventListener('click', function() {
  loadResult('/post?' + encodeForm(postForm), postResult);
});
querySubmit.addEventListener('click', function() {
  loadResult('/query?' + encodeForm(queryForm), queryResult);
});
</script>
