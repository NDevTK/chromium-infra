<!-- Copyright (c) 2014 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file. -->

<link rel="import" href="cr-patchset-title-dialog.html">

<polymer-element name="cr-patchset-header" attributes="patchset">
    <template>
        <style>
            :host {
                display: block;
                background: #F6F6F6;
                border-bottom: 1px solid #ebebeb;
                display: flex;
                padding: 0.5em 16px;
                position: relative;
            }

            .patchset-title {
                flex: 1;
                font-weight: bold;
            }

            .patchset-comments {
                padding: 0 16px;
            }

            .edit-title-link {
                 font-size: 80%;
                 cursor: pointer;
                 vertical-align: top;
            }
        </style>
        <div class="patchset-title">
            Patch {{ patchset.sequence }}<template if="{{ patchset.message }}">: {{ patchset.message }}</template>
            <template if="{{ userIsOwner }}">
              <cr-action class="edit-title-link" on-tap="{{ showEditTitleDialog }}">(edit)</cr-action>
	    </template>
        </div>
        <div class="patchset-comments">
            {{ patchset.messageCount - patchset.draftCount | pluralize("comment") }}
            <template if="{{ patchset.draftCount }}">
                <template if="{{ patchset.messageCount - patchset.draftCount }}">,</template>
                {{ patchset.draftCount | pluralize("draft") }}
            </template>
        </div>
        <div class="patchset-date">{{ patchset.created | formatDate }}</div>

        <div id="dialogs"></div>
    </template>
    <script>
        Polymer("cr-patchset-header", {
            patchset: null,
            userIsOwner: false,
            domReady: function() {
              this.userIsOwner = this.patchset.issue.owner.isCurrentUser();
            },
            pluralize: function(count, text) {
                if (!count)
                    return "";
                if (count == 1)
                    return count + " " + text;
                return count + " " + text.pluralize();
            },
            formatDate: function(date) {
                if (!date)
                    return "";
                return date.relative();
            },
            showDialog: function(dialog) {
                this.$.dialogs.appendChild(dialog);
                dialog.addEventListener("close", function() {
                    dialog.remove();
                });
                dialog.showModal();
            },
            showEditTitleDialog: function() {
                var dialog = document.createElement("cr-patchset-title-dialog");
                dialog.patchset = this.patchset;
                dialog.orig_title = this.patchset.message;
                this.showDialog(dialog);
            },
        });
    </script>
</polymer-element>
