<!-- A service that interfaces with luci-dm -->
<link rel="import" href="/components/polymer/polymer.html">
<link rel="import" href="/components/core-ajax/core-ajax.html">

<polymer-element name="milo-swarming-service"
                 attributes="root swarming_id">
  <template>
    <style>
      :host {
        display: none;
      }
    </style>
    <core-ajax
         auto
         url="/_ah/api/log/v1/swarming/{{swarming_id}}"
         response="{{log}}"
         handleAs="json">
    </core-ajax>
  </template>
  <script>
    Polymer("milo-swarming-service", {
      created: function() {
        this.root = {};
      },

      getTopbar: function(attemptRoot) {
        var results = [];
        if (!attemptRoot.Failure) {
          results.push({
            mainText: "This attempt succeeded!"
          });
        } else {
          results.push({
            mainText: "This attempt failed!"
          });
        }

        return results;
      },

      getStep: function(step) {
        console.log(step);
        var result = {
          mainText: step.name,
          isFailure: false
        };
        if (step.result && step.result.Failure) {
          result.status = "failure";
        } else {
          result.status = "success";
        }
        return result;
      },

      getSteps: function(log) {
        var results = [];
        var steps = JSON.parse(log.steps);
        for (i in steps) {
          results.push(this.getStep(steps[i]));
        }
        return results
      },

      foo: function(log) {
        var topbar = [];
        var properties = [];
        var steps = []
        if (log) {
          topbar = this.getTopbar(log);
          steps = this.getSteps(log);
        }
        return {
          name: this.swarming_id,
          topbar: topbar,
          steps: steps,
          nav: [
            {name: 'foo'},
            {name: 'bar'},
            {name: 'baz'}],
          properties: [],
          revisions:[]
        };
      },

      computed: {
        root: 'foo(log)'
      }
    });
  </script>
</polymer-element>
