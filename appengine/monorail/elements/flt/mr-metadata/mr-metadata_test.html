<meta charset="utf-8">
<script src="/bower_components/webcomponentsjs/webcomponents-loader.js"></script>
<script src="/bower_components/web-component-tester/browser.js"></script>
<link rel="import" href="/elements/flt/mr-metadata/mr-metadata.html">
<test-fixture id="basic">
  <template>
    <mr-metadata></mr-metadata>
  </template>
</test-fixture>
<script>
(function() {
  'use strict';

  suite('computed properties', function() {
    var element;

    setup(function() {
      element = fixture('basic');
      element.projectName = 'proj';
      element.blockerReferences = new Map([
        [
          'proj:1', {
            issue: {summary: 'Issue 1'},
          },
        ],
        [
          'proj:2', {
            issue: {summary: 'Issue 2'},
            isClosed: true,
          },
        ],
        [
          'proj:3', {
            issue: {summary: 'Issue 3'},
          },
        ],
        [
          'proj2:4', {
            issue: {summary: 'Issue 4 on another project'},
            isClosed: true,
          },
        ],
        [
          'proj:5', {
            issue: {summary: 'Issue 5'},
          },
        ],
        [
          'proj2:6', {
            issue: {summary: 'Issue 6 on another project'},
          },
        ],
      ]);
      element.blockedOn = [
        {projectName: 'proj', localId: 1},
        {projectName: 'proj', localId: 2},
        {projectName: 'proj', localId: 3},
        {projectName: 'proj2', localId: 4},
        {projectName: 'proj', localId: 5},
        {projectName: 'proj2', localId: 6},
      ];
    });

    test('sorts blocked on', function() {
      assert.deepEqual(element.sortedBlockedOn, [
        {projectName: 'proj', localId: 1},
        {projectName: 'proj', localId: 3},
        {projectName: 'proj', localId: 5},
        {projectName: 'proj2', localId: 6},
        {projectName: 'proj', localId: 2},
        {projectName: 'proj2', localId: 4},
      ]);
    });

    test('computes blocked on table rows', function() {
      assert.deepEqual(element.blockedOnTableRows, [
        {
          cells: [
            {
              type: 'issue',
              projectName: 'proj',
              issue: {summary: 'Issue 1'},
              isClosed: false,
            },
            {
              type: 'text',
              content: 'Issue 1',
            },
          ],
        },
        {
          cells: [
            {
              type: 'issue',
              projectName: 'proj',
              issue: {summary: 'Issue 3'},
              isClosed: false,
            },
            {
              type: 'text',
              content: 'Issue 3',
            },
          ],
        },
        {
          cells: [
            {
              type: 'issue',
              projectName: 'proj',
              issue: {summary: 'Issue 5'},
              isClosed: false,
            },
            {
              type: 'text',
              content: 'Issue 5',
            },
          ],
        },
        {
          cells: [
            {
              type: 'issue',
              projectName: 'proj',
              issue: {summary: 'Issue 6 on another project'},
              isClosed: false,
            },
            {
              type: 'text',
              content: 'Issue 6 on another project',
            },
          ],
        },
        {
          cells: [
            {
              type: 'issue',
              projectName: 'proj',
              issue: {summary: 'Issue 2'},
              isClosed: true,
            },
            {
              type: 'text',
              content: 'Issue 2',
            },
          ],
        },
        {
          cells: [
            {
              type: 'issue',
              projectName: 'proj',
              issue: {summary: 'Issue 4 on another project'},
              isClosed: true,
            },
            {
              type: 'text',
              content: 'Issue 4 on another project',
            },
          ],
        },
      ]);
    });
  });
})();
</script>
