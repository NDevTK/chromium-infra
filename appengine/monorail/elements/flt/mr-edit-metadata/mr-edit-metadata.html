<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../redux/redux-mixin.html">
<link rel="import" href="../../redux/compute-functions.html">
<link rel="import" href="./mr-multi-input.html">

<dom-module id="mr-edit-metadata">
  <template>
    <style>
      :host {
        display: block;
        --mr-multi-input-styles: {
          box-sizing: border-box;
          width: 100%;
          padding: 0.25em 4px;
        }
      }
      select,
      input {
        @apply --mr-multi-input-styles;
      }
      input[type="checkbox"] {
        width: auto;
      }
      label {
        font-weight: bold;
        word-wrap: break-word;
      }
      label.checkbox {
        font-weight: normal;
      }
      textarea {
        width: 100%;
        margin: 0.5em 0;
        box-sizing: border-box;
        border: 1px solid hsl(0, 0%, 80%);
        height: 8em;
        transition: height 0.1s ease-in-out;
        padding: 0.5em 4px;
        grid-column-start: 1;
        grid-column-end: 2;
      }
      textarea:placeholder-shown {
        height: 5em;
      }
      textarea:focus {
        height: 8em;
      }
      .input-grid {
        padding: 0.5em 0;
        display: grid;
        max-width: 100%;
        grid-gap: 8px;
        grid-template-columns: 25% auto;
        align-items: flex-start;
      }
    </style>
    <form id="editForm">
      <div class="input-grid">
        <template is="dom-if" if="[[!isApproval]]">
          <label for="summaryInput">Summary:</label>
          <input id="summaryInput" value$="[[summary]]" />
        </template>
        <label for="statusInput">Status:</label>

        <select id="statusInput">
          <template is="dom-repeat" items="[[statuses]]">
            <option
              value$="[[item.status]]"
              hidden$="[[_statusIsHidden(status, item)]]"
              selected$="[[_computeIsSelected(status, item.status)]]"
            >
              [[item.status]]
              <template is="dom-if" if="[[item.docstring]]">
                - [[item.docstring]]
              </template>
            </option>
          </template>
        </select>


        <template is="dom-if" if="[[!isApproval]]">
          <label for="ownerInput" on-click="_clickLabelForCustomInput">Owner:</label>
          <mr-multi-input
            id="ownerInput"
            values="[[_wrapList(owner.displayName)]]"
            limit=1
          ></mr-multi-input>

          <label for="ccInput" on-click="_clickLabelForCustomInput">CC:</label>
          <mr-multi-input
            id="ccInput"
            values="[[_mapUserRefsToNames(cc)]]"
          ></mr-multi-input>
        </template>

        <template is="dom-if" if="[[_and(isApprover, isApproval)]]">
          <label for="approversInput" on-click="_clickLabelForCustomInput">Approvers:</label>
          <mr-multi-input
            id="approversInput"
            values="[[_mapUserRefsToNames(approvers)]]"
          ></mr-multi-input>
        </template>

        <template is="dom-repeat" items="[[users]]" as="user">
          <label for$="[[_idForField(user.name)]]">[[user.name]]:</label>

          <!--TODO(zhangtiff): Replace this with a multi input widget once
          we have a stable and reliable one. -->
          <input id$="[[_idForField(user.name)]]" value$="[[_joinValues(user.values)]]" />
        </template>
        <template is="dom-repeat" items="[[urls]]" as="url">
          <label for$="[[_idForField(url.name)]]">[[url.name]]:</label>
          <input id$="[[_idForField(url.name)]]" value$="[[_joinValues(url.values)]]" />
        </template>
        <template is="dom-repeat" items="[[enums]]" as="enum">
          <label for$="[[_idForField(enum.name)]]">[[enum.name]]:</label>
          <div>
            <template is="dom-repeat" items="[[enum.choices]]" as="choice">
              <label class="checkbox" for$="[[_idForField(enum.name, choice)]]">
                <input
                  id$="[[_idForField(enum.name, choice)]]"
                  type="checkbox" name="[[enum.name]]" value="choice"
                />
                [[choice]]
              </label>
            </template>
          </div>
        </template>
        <template is="dom-if" if="[[!isApproval]]">
          <label for="blockedOnInput" on-click="_clickLabelForCustomInput">Blocked on:</label>
          <mr-multi-input id="blockedOnInput" values="[[_blockedOnIds]]"></mr-multi-input>

          <label for="blockingInput" on-click="_clickLabelForCustomInput">Blocking:</label>
          <mr-multi-input id="blockingInput" values="[[_blockingIds]]"></mr-multi-input>

          <label for="labelsInput" on-click="_clickLabelForCustomInput">Labels:</label>
          <mr-multi-input id="labelsInput" values="[[labelNames]]"></mr-multi-input>
        </template>
      </div>
      <textarea id="commentText" placeholder="Comment to explain this change"></textarea>
    </form>
  </template>
  <script src="./mr-edit-metadata.js"></script>
<dom-module>
