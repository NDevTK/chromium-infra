<!--
Copyright 2014 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="../model/cq-graph.html">
<link rel="import" href="../model/cqstats-graph-data.html">
<link rel="import" href="../model/json-graph-data.html">
<link rel="import" href="./tom-cq-graph.html">

<polymer-element name="tom-cq-graphs" attributes="project">
  <template>
    <h1>Commit Queue Status</h1>
    <template repeat="{{ graph in graphList }}">
      <tom-cq-graph graph="{{ graph }}"></tom-cq-graph>
    </template>
  </template>
  <script>
    Polymer({
      ready: function() {
        this.graphList = this._timeGraphs();
        this.graphList.push(this._queueLengthGraph());
      },
      _timeGraphs: function() {
        var intervalMinutes = 60;
        var cqStatsCount = 25;
        var varying = [{
          heading: 'Times: Single Run',
          statName: 'attempt-durations',
          alerts: {
            p90: 120,
            mean: 60,
          },
        }, {
          heading: 'Times: Time in Queue Over All Runs',
          statName: 'patchset-total-commit-queue-durations',
          alerts: {},
        }, {
          heading: 'Times: Time from Checking "Commit" Box to Complete',
          statName: 'patchset-total-wall-time-durations',
          alerts: {},
        }];
        var dataList = CQStatsGraphData.createBatch(
            this.project, intervalMinutes, cqStatsCount,
            varying.map(function(item) {return item.statName}));
        return dataList.map(function(data, i) {
          return new CQGraph(varying[i].heading, data, varying[i].alerts);
        });
      },
      _queueLengthGraph: function() {
        var url = '/project/' + this.project + '/cq-length';
        return new CQGraph('Commit Queue Length', new JSONGraphData(url), {});
      },
    });
  </script>
</polymer-element>
