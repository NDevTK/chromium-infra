[
  {
    "cmd": [
      "vpython",
      "-u",
      "RECIPE_MODULE[recipe_engine::file]/resources/fileutil.py",
      "--json-output",
      "/path/to/tmp/json",
      "compute_hash",
      "RECIPE_REPO[infra]",
      "recipes/recipe_modules/support_3pp",
      "recipes/recipes/3pp.py",
      "infra/tools/dockerbuild"
    ],
    "infra_step": true,
    "name": "compute recipe file hash",
    "~followup_annotations": [
      "@@@STEP_TEXT@Hash calculated: deadbeef@@@"
    ]
  },
  {
    "cmd": [
      "echo",
      "3pp/"
    ],
    "env": {
      "CIPD_CACHE_DIR": "[CLEANUP]/tmp_tmp_1"
    },
    "name": "echo package_prefix"
  },
  {
    "cmd": [
      "vpython",
      "-u",
      "RECIPE_MODULE[recipe_engine::file]/resources/fileutil.py",
      "--json-output",
      "/path/to/tmp/json",
      "glob",
      "[CACHE]/builder/package_repo",
      "*/3pp.pb"
    ],
    "env": {
      "CIPD_CACHE_DIR": "[CLEANUP]/tmp_tmp_1"
    },
    "infra_step": true,
    "name": "find package specs",
    "~followup_annotations": [
      "@@@STEP_LOG_LINE@glob@[CACHE]/builder/package_repo/[CACHE]/builder/package_repo/dep/3pp.pb@@@",
      "@@@STEP_LOG_LINE@glob@[CACHE]/builder/package_repo/[CACHE]/builder/package_repo/tool/3pp.pb@@@",
      "@@@STEP_LOG_LINE@glob@[CACHE]/builder/package_repo/[CACHE]/builder/package_repo/unsupported/3pp.pb@@@",
      "@@@STEP_LOG_END@glob@@@"
    ]
  },
  {
    "cmd": [],
    "name": "load package specs"
  },
  {
    "cmd": [
      "vpython",
      "-u",
      "RECIPE_MODULE[recipe_engine::file]/resources/fileutil.py",
      "--json-output",
      "/path/to/tmp/json",
      "compute_hash",
      "[START_DIR]",
      "../[CACHE]/builder/package_repo"
    ],
    "env": {
      "CIPD_CACHE_DIR": "[CLEANUP]/tmp_tmp_1"
    },
    "infra_step": true,
    "name": "load package specs.Compute package hash",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@",
      "@@@STEP_TEXT@Hash calculated: deadbeef@@@"
    ]
  },
  {
    "cmd": [
      "vpython",
      "-u",
      "RECIPE_MODULE[recipe_engine::file]/resources/fileutil.py",
      "--json-output",
      "/path/to/tmp/json",
      "copy",
      "[CACHE]/builder/package_repo/[CACHE]/builder/package_repo/dep/3pp.pb",
      "/path/to/tmp/"
    ],
    "env": {
      "CIPD_CACHE_DIR": "[CLEANUP]/tmp_tmp_1"
    },
    "infra_step": true,
    "name": "load package specs.read 'dep'",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@",
      "@@@STEP_LOG_LINE@3pp.pb@@@@",
      "@@@STEP_LOG_LINE@3pp.pb@  create {@@@",
      "@@@STEP_LOG_LINE@3pp.pb@    platform_re: \"linux-amd64|mac-.*\"@@@",
      "@@@STEP_LOG_LINE@3pp.pb@    source {@@@",
      "@@@STEP_LOG_LINE@3pp.pb@      git {@@@",
      "@@@STEP_LOG_LINE@3pp.pb@        repo: \"https://chromium.googlesource.com/external/go.repo/dep\"@@@",
      "@@@STEP_LOG_LINE@3pp.pb@        tag_pattern: \"v%s\"@@@",
      "@@@STEP_LOG_LINE@3pp.pb@      }@@@",
      "@@@STEP_LOG_LINE@3pp.pb@    }@@@",
      "@@@STEP_LOG_LINE@3pp.pb@    build {}@@@",
      "@@@STEP_LOG_LINE@3pp.pb@  }@@@",
      "@@@STEP_LOG_LINE@3pp.pb@  upload { pkg_prefix: \"pkg\" }@@@",
      "@@@STEP_LOG_LINE@3pp.pb@  @@@",
      "@@@STEP_LOG_END@3pp.pb@@@"
    ]
  },
  {
    "cmd": [
      "vpython",
      "-u",
      "RECIPE_MODULE[recipe_engine::file]/resources/fileutil.py",
      "--json-output",
      "/path/to/tmp/json",
      "copy",
      "[CACHE]/builder/package_repo/[CACHE]/builder/package_repo/tool/3pp.pb",
      "/path/to/tmp/"
    ],
    "env": {
      "CIPD_CACHE_DIR": "[CLEANUP]/tmp_tmp_1"
    },
    "infra_step": true,
    "name": "load package specs.read 'tool'",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@",
      "@@@STEP_LOG_LINE@3pp.pb@@@@",
      "@@@STEP_LOG_LINE@3pp.pb@  create {@@@",
      "@@@STEP_LOG_LINE@3pp.pb@    platform_re: \"linux-amd64|mac-.*\"@@@",
      "@@@STEP_LOG_LINE@3pp.pb@    source {@@@",
      "@@@STEP_LOG_LINE@3pp.pb@      git {@@@",
      "@@@STEP_LOG_LINE@3pp.pb@        repo: \"https://go.repo/tool\"@@@",
      "@@@STEP_LOG_LINE@3pp.pb@        version_restriction { op: LT val: \"1.5rc\" }@@@",
      "@@@STEP_LOG_LINE@3pp.pb@        version_restriction { op: GE val: \"1.4\" }@@@",
      "@@@STEP_LOG_LINE@3pp.pb@      }@@@",
      "@@@STEP_LOG_LINE@3pp.pb@    }@@@",
      "@@@STEP_LOG_LINE@3pp.pb@    build {@@@",
      "@@@STEP_LOG_LINE@3pp.pb@      tool: \"dep\"@@@",
      "@@@STEP_LOG_LINE@3pp.pb@    }@@@",
      "@@@STEP_LOG_LINE@3pp.pb@  }@@@",
      "@@@STEP_LOG_LINE@3pp.pb@  upload { pkg_prefix: \"pkg\" }@@@",
      "@@@STEP_LOG_LINE@3pp.pb@  @@@",
      "@@@STEP_LOG_END@3pp.pb@@@"
    ]
  },
  {
    "cmd": [
      "vpython",
      "-u",
      "RECIPE_MODULE[recipe_engine::file]/resources/fileutil.py",
      "--json-output",
      "/path/to/tmp/json",
      "copy",
      "[CACHE]/builder/package_repo/[CACHE]/builder/package_repo/unsupported/3pp.pb",
      "/path/to/tmp/"
    ],
    "env": {
      "CIPD_CACHE_DIR": "[CLEANUP]/tmp_tmp_1"
    },
    "infra_step": true,
    "name": "load package specs.read 'unsupported'",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@",
      "@@@STEP_LOG_LINE@3pp.pb@@@@",
      "@@@STEP_LOG_LINE@3pp.pb@  create { verify { test: \"verify.py\" } }@@@",
      "@@@STEP_LOG_LINE@3pp.pb@  @@@",
      "@@@STEP_LOG_END@3pp.pb@@@"
    ]
  },
  {
    "cmd": [],
    "name": "building dep",
    "~followup_annotations": [
      "@@@STEP_EXCEPTION@@@"
    ]
  },
  {
    "cmd": [
      "git",
      "ls-remote",
      "-t",
      "https://chromium.googlesource.com/external/go.repo/dep"
    ],
    "cwd": "None",
    "env": {
      "CIPD_CACHE_DIR": "[CLEANUP]/tmp_tmp_1",
      "GOARCH": "amd64",
      "GOOS": "linux",
      "_3PP_PACKAGE_NAME": "dep",
      "_3PP_PLATFORM": "linux-amd64",
      "_3PP_TOOL_PLATFORM": "linux-amd64"
    },
    "infra_step": true,
    "name": "building dep.git ls-remote",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@",
      "@@@STEP_TEXT@resolved version: 1.5.0-rc1@@@"
    ]
  },
  {
    "cmd": [
      "cipd",
      "describe",
      "3pp/pkg/dep/linux-amd64",
      "-version",
      "version:1.5.0-rc1",
      "-json-output",
      "/path/to/tmp/json"
    ],
    "env": {
      "CIPD_CACHE_DIR": "[CLEANUP]/tmp_tmp_1",
      "GOARCH": "amd64",
      "GOOS": "linux",
      "_3PP_PACKAGE_NAME": "dep",
      "_3PP_PLATFORM": "linux-amd64",
      "_3PP_TOOL_PLATFORM": "linux-amd64"
    },
    "name": "building dep.cipd describe 3pp/pkg/dep/linux-amd64",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@",
      "@@@STEP_TEXT@tag 'version:1.5.0-rc1' not found@@@",
      "@@@STEP_LOG_LINE@json.output@{@@@",
      "@@@STEP_LOG_LINE@json.output@  \"error\": \"no such tag\", @@@",
      "@@@STEP_LOG_LINE@json.output@  \"result\": null@@@",
      "@@@STEP_LOG_LINE@json.output@}@@@",
      "@@@STEP_LOG_END@json.output@@@"
    ]
  },
  {
    "cmd": [
      "vpython",
      "-u",
      "RECIPE_MODULE[recipe_engine::file]/resources/fileutil.py",
      "--json-output",
      "/path/to/tmp/json",
      "ensure-directory",
      "--mode",
      "0777",
      "[START_DIR]/3pp/wd/dep/linux-amd64/1.5.0-rc1"
    ],
    "env": {
      "CIPD_CACHE_DIR": "[CLEANUP]/tmp_tmp_1",
      "GOARCH": "amd64",
      "GOOS": "linux",
      "_3PP_PACKAGE_NAME": "dep",
      "_3PP_PLATFORM": "linux-amd64",
      "_3PP_TOOL_PLATFORM": "linux-amd64",
      "_3PP_VERSION": "1.5.0-rc1"
    },
    "infra_step": true,
    "name": "building dep.mkdir -p [workdir]",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@"
    ]
  },
  {
    "cmd": [],
    "name": "building dep.fetch sources",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@1@@@",
      "@@@STEP_EXCEPTION@@@"
    ]
  },
  {
    "cmd": [
      "cipd",
      "describe",
      "3pp/sources/git/go.repo/dep",
      "-version",
      "version:1.5.0-rc1",
      "-json-output",
      "/path/to/tmp/json"
    ],
    "env": {
      "CIPD_CACHE_DIR": "[CLEANUP]/tmp_tmp_1",
      "GOARCH": "amd64",
      "GOOS": "linux",
      "_3PP_PACKAGE_NAME": "dep",
      "_3PP_PLATFORM": "linux-amd64",
      "_3PP_TOOL_PLATFORM": "linux-amd64",
      "_3PP_VERSION": "1.5.0-rc1"
    },
    "name": "building dep.fetch sources.cipd describe 3pp/sources/git/go.repo/dep",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@2@@@",
      "@@@STEP_TEXT@found 'resolved-instance_id-of-version:1.5.0-rc'@@@",
      "@@@STEP_LOG_LINE@json.output@{@@@",
      "@@@STEP_LOG_LINE@json.output@  \"result\": {@@@",
      "@@@STEP_LOG_LINE@json.output@    \"pin\": {@@@",
      "@@@STEP_LOG_LINE@json.output@      \"instance_id\": \"resolved-instance_id-of-version:1.5.0-rc\", @@@",
      "@@@STEP_LOG_LINE@json.output@      \"package\": \"3pp/sources/git/go.repo/dep\"@@@",
      "@@@STEP_LOG_LINE@json.output@    }, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"refs\": [@@@",
      "@@@STEP_LOG_LINE@json.output@      {@@@",
      "@@@STEP_LOG_LINE@json.output@        \"instance_id\": \"resolved-instance_id-of-latest----------\", @@@",
      "@@@STEP_LOG_LINE@json.output@        \"modified_by\": \"user:44-blablbla@developer.gserviceaccount.com\", @@@",
      "@@@STEP_LOG_LINE@json.output@        \"modified_ts\": 1446574210, @@@",
      "@@@STEP_LOG_LINE@json.output@        \"ref\": \"latest\"@@@",
      "@@@STEP_LOG_LINE@json.output@      }@@@",
      "@@@STEP_LOG_LINE@json.output@    ], @@@",
      "@@@STEP_LOG_LINE@json.output@    \"registered_by\": \"user:44-blablbla@developer.gserviceaccount.com\", @@@",
      "@@@STEP_LOG_LINE@json.output@    \"registered_ts\": 1446574210, @@@",
      "@@@STEP_LOG_LINE@json.output@    \"tags\": [@@@",
      "@@@STEP_LOG_LINE@json.output@      {@@@",
      "@@@STEP_LOG_LINE@json.output@        \"registered_by\": \"user:44-blablbla@developer.gserviceaccount.com\", @@@",
      "@@@STEP_LOG_LINE@json.output@        \"registered_ts\": 1446574210, @@@",
      "@@@STEP_LOG_LINE@json.output@        \"tag\": \"version:1.5.0-rc1\"@@@",
      "@@@STEP_LOG_LINE@json.output@      }, @@@",
      "@@@STEP_LOG_LINE@json.output@      {@@@",
      "@@@STEP_LOG_LINE@json.output@        \"registered_by\": \"user:44-blablbla@developer.gserviceaccount.com\", @@@",
      "@@@STEP_LOG_LINE@json.output@        \"registered_ts\": 1446574210, @@@",
      "@@@STEP_LOG_LINE@json.output@        \"tag\": \"external_hash:deadbeef\"@@@",
      "@@@STEP_LOG_LINE@json.output@      }@@@",
      "@@@STEP_LOG_LINE@json.output@    ]@@@",
      "@@@STEP_LOG_LINE@json.output@  }@@@",
      "@@@STEP_LOG_LINE@json.output@}@@@",
      "@@@STEP_LOG_END@json.output@@@"
    ]
  },
  {
    "cmd": [],
    "name": "building dep.fetch sources.Verify External Hash",
    "~followup_annotations": [
      "@@@STEP_NEST_LEVEL@2@@@",
      "@@@STEP_TEXT@resolved version: 1.5.0-rc1 has moved, current hash: hash, stored hash: deadbeef, please verify.@@@",
      "@@@STEP_FAILURE@@@"
    ]
  },
  {
    "cmd": [],
    "name": "RECIPE CRASH (Uncaught exception)",
    "~followup_annotations": [
      "@@@STEP_EXCEPTION@@@",
      "The recipe has crashed at point 'Uncaught exception'!",
      "",
      "Traceback (most recent call last):",
      "  File \"RECIPE_REPO[infra]/recipes/recipe_modules/support_3pp/tests/full.py\", line 50, in RunSteps",
      "    pkgs, '%s-%s' % (GOOS, GOARCH))",
      "  File \"RECIPE_REPO[infra]/recipes/recipe_modules/support_3pp/api.py\", line 663, in ensure_uploaded",
      "    ret.append(self._build_resolved_spec(spec, version, force_build))",
      "  File \"RECIPE_REPO[infra]/recipes/recipe_modules/support_3pp/api.py\", line 532, in _build_resolved_spec",
      "    spec, version, self._infra_3pp_hash.hexdigest())",
      "  File \"RECIPE_REPO[infra]/recipes/recipe_modules/support_3pp/create.py\", line 89, in build_resolved_spec",
      "    spec, version, git_hash, ecosystem_hash)",
      "  File \"RECIPE_REPO[infra]/recipes/recipe_modules/support_3pp/create.py\", line 102, in _build_impl",
      "    api, workdir, spec, version, git_hash, spec_lookup, recurse_fn)",
      "  File \"RECIPE_REPO[infra]/recipes/recipe_modules/support_3pp/source.py\", line 235, in fetch_source",
      "    'External hash verification failed, please check the third party'",
      "AssertionError: External hash verification failed, please check the third party git repository for any security incidents."
    ]
  },
  {
    "failure": {
      "humanReason": "Uncaught Exception: AssertionError('External hash verification failed, please check the third party git repository for any security incidents.',)"
    },
    "name": "$result"
  }
]