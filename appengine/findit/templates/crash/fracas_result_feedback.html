<!DOCTYPE html>
<head>
  <title>Fracas result feedback</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="/common.css">
  <style>
    .error {
      color: #ffffff;
      background-color: #e98080;
      border-color: #a77272;
    }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script>
    function createUrl(base_url, parameters) {
      var params = [];
      for(var key in parameters) {
        if (parameters[key] != undefined) {
          params.push(key + '=' + parameters[key]);
        }
      }

      if (params.length == 0) {
        return base_url;
      } else {
        return base_url + '?' + params.join('&');
      }
    }

    function constructMonorailUrl() {
      var parameters = {};
      parameters.status = 'Unconfirmed';
      parameters.labels = 'Pri-2,Restrict-View-Google';
      parameters.components = 'Tools>Test>Findit';
      parameters.summary = encodeURIComponent('[Findit] Findit bug or feature');
      parameters.comment = encodeURIComponent(
          'Signature: {{signature}}\nVersion: {{version}}\n' +
          'Channel: {{channel}}\nPlatform: {{platform}}\n\n' +
          'Findit result: ' + window.location.href +
          '\n\nWhat is the bug or feature?');
      return createUrl('https://code.google.com/p/chromium/issues/entry',
                       parameters);
    }

    $(document).ready(function() {
      $('#monorail-bug').attr('href', constructMonorailUrl());
    })
  </script>
</head>
<body>
  <div>
    <b>Crash:</b> (<a href="#" id='monorail-bug'>File a Findit bug</a>)
    <br>
    Signature: {{signature}}<br>
    Version: <a href="https://chromium.googlesource.com/chromium/src.git/+/{{version}}">{{version}}</a><br>
    Channel: {{channel}}<br>
    Platform: {{platform}}<br>
    Request time: {{request_time}}<br>
    <br>
  </div>

  <div>
    <b> Stacktrace: </b>
    <pre>{{stack_trace}}</pre>
  </div>

  <div>
    <br>
    <b> Historical metadata (last 20 versions):</b>
    <table id="reliable_failures_table">
      <tbody>
        <tr>
          <td align="center">Version</td>
          {% for metadata in historical_metadata %}
            <td align="center" width="40"> {{metadata.chrome_version}} </td>
          {% endfor %}
        </tr>
        <tr>
          <td align="center">CPM</td>
          {% for metadata in historical_metadata %}
            <td align="center" width="40"> {{metadata.cpm}} </td>
          {% endfor %}
        </tr>
        <tr>
          <td align="center">Total clients</td>
          {% for metadata in historical_metadata %}
            <td align="center" width="40"> {{metadata.client_number}} </td>
          {% endfor %}
        </tr>
        <tr>
          <td align="center">Total reports</td>
          {% for metadata in historical_metadata %}
            <td align="center" width="40"> {{metadata.report_number}} </td>
          {% endfor %}
        </tr>
      </tbody>
    </table>
  </div>

  <div>
    <br>
    <b> Regression range: </b>
    {% if regression_range %}
      <a href="https://chromium.googlesource.com/chromium/src/+log/{{regression_range[0]}}..{{regression_range[1]}}?pretty=fuller">{{regression_range[0]}} : {{regression_range[1]}}</a>
    {% else %}
      Not found
    {% endif %}
    <br>
  <div>

  <div>
    <br><br>
    {% if analysis_completed %}
      {% if analysis_failed %}
      <span class="error">No result because of some error in analysis!</span>
      {% else %}
      <b> Suspected cls: </b>
        {% if suspected_cls %}
        <table id="suspected_cls_table">
          <tr>
            <th>Suspected cls</th>
            <th>Score</th>
            <th>Reason</th>
          </tr>
          <tbody>
            {% for suspected_cl in suspected_cls %}
              <tr>
                <td align="center"> <a href={{suspected_cl.url}}>{{suspected_cl.revision}}</a> </td>
                <td align="center"> {{suspected_cl.confidence}} </td>
                <td align="left"><pre>{{suspected_cl.reason}}</pre></td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
          Not found <br>
        {% endif %}
      {% endif %}
    {% endif %}
  </div>

  <div>
    <br><br>
    <b> Suspected project: </b>
    {% if suspected_project %}
      {{suspected_project}}
    {% else %}
      Not found
    {% endif %}
    <br>
  </div>

  <div>
    <br><br>
    <b> Suspected components:</b>
    {% if suspected_components %}
      <br>
      {% for component in suspected_components %}
      <li>
        {{component}}
      </li>
      {% endfor %}
    {% else %}
      Not found <br>
    {% endif %}
  </div>

</body>
