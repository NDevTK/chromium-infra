<meta charset="utf-8">
<script src="/bower_components/webcomponentsjs/webcomponents-loader.js"></script>
<script src="/bower_components/web-component-tester/browser.js"></script>
<link rel="import" href="/elements/flt/mr-metadata/mr-update-issue-hotlists.html">
<test-fixture id="basic">
  <template>
    <mr-update-issue-hotlists></mr-update-issue-hotlists>
  </template>
</test-fixture>
<script>
(function() {
  'use strict';

  suite('basic tests', function() {
    var element;
    var form;

    setup(function() {
      element = fixture('basic');
      form = Polymer.dom(element.root).querySelector('#issueHotlistsForm');
    });

    test('no changes', function() {
      assert.deepEqual(element.changes, {added: [], removed: []});
    });

    test('selecting new issues produces changes', function(done) {
      element.issueHotlists = [
        {name: 'Hotlist-1', ownerRef: {userId: 12345}},
        {name: 'Hotlist-2', ownerRef: {userId: 12345}},
        {name: 'Hotlist-1', ownerRef: {userId: 67890}},
      ];
      element.userHotlists = [
        {name: 'Hotlist-1', ownerRef: {userId: 67890}},
        {name: 'Hotlist-2', ownerRef: {userId: 67890}},
      ];
      element.user = {userId: 67890};
      flush(() => {
        form['Hotlist-1'].checked = false;
        form['Hotlist-2'].checked = true;
        assert.deepEqual(element.changes, {
          added: [{name: 'Hotlist-2', owner: {userId: 67890}}],
          removed: [{name: 'Hotlist-1', owner: {userId: 67890}}],
        });
        done();
      });
    });

    test('adding new issue produces changes', function(done) {
      flush(() => {
        form._newHotlistName.value = 'New-Hotlist';
        assert.deepEqual(element.changes, {
          added: [],
          removed: [],
          created: {
            name: 'New-Hotlist',
            summary: 'Hotlist created from issue.',
          },
        });
        done();
      });
    });

    test('reset changes', function(done) {
      element.issueHotlists = [
        {name: 'Hotlist-1', ownerRef: {userId: 12345}},
        {name: 'Hotlist-2', ownerRef: {userId: 12345}},
        {name: 'Hotlist-1', ownerRef: {userId: 67890}},
      ];
      element.userHotlists = [
        {name: 'Hotlist-1', ownerRef: {userId: 67890}},
        {name: 'Hotlist-2', ownerRef: {userId: 67890}},
      ];
      element.user = {userId: 67890};
      flush(() => {
        form['Hotlist-1'].checked = false;
        form['Hotlist-2'].checked = true;
        form._newHotlisName = 'New-Hotlist';
        element.reset();
        assert.isTrue(form['Hotlist-1'].checked);
        assert.isFalse(form['Hotlist-2'].checked);
        assert.equal(form._newHotlistName.value, '');
        done();
      });
    });
  });
})();
</script>
