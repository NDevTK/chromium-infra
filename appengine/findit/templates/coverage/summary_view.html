<!DOCTYPE html>
<head>
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <title>Coverage Summary for {{project}} - {{data.commit_position or revision}} - {{path}}</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="/common.css">
  <style>
    .coverage-header {
      padding: 5px 10px;
      border-bottom: 1px solid #DBDBDB;
      background-color: #EEE;
      line-height: 30px;
      text-align: center;
      font-weight: bold;
      font-size: 24px;
    }
    .low-coverage {
      background-color: #FFD0D0;
    }
    .medium-coverage {
      background-color: #FFFFF0;
    }
    .high-coverage {
      background-color: #D0FFD0;
    }
    tbody tr:hover td, tfoot tr:hover td {
      background-color: #F5F5F5;
      border-color: #E4E4E4 !important;
    }
    thead a:hover {
      background-color: yellow;
    }
  </style>
  <script src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="/ui/elements/findit-app.html">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script>
    $(function() {
      document.getElementById('app').userInfo = {{ (user_info or {}) | tojson | safe }};
    });
  </script>
</head>

<body>
  <findit-app id="app" page-header="Code Coverage">
    <div>
      <table>
        <thead>
          <tr class="coverage-header">
            <th colspan="4">
              <a href="./coverage?host={{host}}&project={{project}}">{{project}}</a>
              - {{data.commit_position or revision}}
              {% if data_type == 'components' %}
                {% if path_root == path %}
                 - ALL
                {% else %}
                - ALL>{{path}}
                {% endif %}
              {% else %}
              - <a title="{{path_root}}" href="./coverage?host={{host}}&project={{project}}&revision={{revision}}&path={{path_root}}">{{path_root}}</a>{% if path_parts %}{% for name, sub_path in path_parts %}<a style="padding-left:.3ex;" title="{{sub_path}}" href="./coverage?host={{host}}&project={{project}}&revision={{revision}}&path={{sub_path}}">{{name}}</a>{% endfor %}{% endif %}
              {% endif %}
            </th>
          </tr>
          <tr>
            {% if data_type == 'components' %}
            <th>Component</th>
            {% else %}
            <th>Path</th>
            {% endif %}
            <th>Line</th>
            <th>Function</th>
            <th>Region</th>
          </tr>
        </thead>

        <tbody>
        {% for datum in (data.metadata.dirs + data.metadata.files) if datum.summaries[0].total %}
          <tr>
            <td><a href="./coverage?host={{host}}&project={{project}}&revision={{revision}}&path={{path}}{{datum.name}}">{{datum.name}}</a></td>
            {% for name in ('line', 'function', 'region') %}
              {% set found = False %}
              {% for metric in datum.summaries %}
                {% if not found and metric.name == name %}
                  {% set found = True %}
                  {% set percentage = metric.covered*100.0/metric.total %}
                  {% if percentage > 99.9999 %}
                    {% set css_class = 'high-coverage' %}
                  {% elif percentage > 79.9999 %}
                    {% set css_class = 'medium-coverage' %}
                  {% else %}
                    {% set css_class = 'low-coverage' %}
                  {% endif %}
                  <td class="{{css_class}}">
                    {{ '{0:.2f}%'.format(percentage) }} ({{metric.covered}}/{{metric.total}})
                  </td>
                {% endif %}
              {% endfor %}
            {% endfor %}
          </tr>
        {% endfor %}
        </tbody>

        {% if data_type == 'dirs' %}
        <tfoot>
          <tr>
            <td>TOTALS</td>
            {% for metric in data.metadata.summaries %}
            {% set percentage = metric.covered*100.0/metric.total %}
            {% if percentage > 99.9999 %}
              {% set css_class = 'high-coverage' %}
            {% elif percentage > 79.9999 %}
              {% set css_class = 'medium-coverage' %}
            {% else %}
              {% set css_class = 'low-coverage' %}
            {% endif %}
            <td class="{{css_class}}">
              {{ '{0:.2f}%'.format(percentage) }} ({{metric.covered}}/{{metric.total}})
            </td>
            {% endfor %}
          </tr>
        </tfoot>
        {% endif %}
      </table>
    </div>
  </findit-app>
</body>
