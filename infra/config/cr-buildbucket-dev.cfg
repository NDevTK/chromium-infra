# Defines buckets on cr-buildbucket-dev.appspot.com.
#
# This is STAGING instance of LUCI. It should not be used for anything
# important.
#
# See https://luci-config.appspot.com/schemas/projects:buildbucket.cfg for
# schema of this file and documentation.

builder_mixins {
  name: "infra-ci"
  dimensions: "cpu:x86-64"
  caches {
    path: "infra_gclient_with_go"
    name: "infra_gclient_with_go"
  }
  task_template_canary_percentage { value: 30 }
}

buckets {
  name: "ci"
  acls {
    role: READER
    group: "all"
  }
  acls {
    role: SCHEDULER
    identity: "luci-scheduler-dev@appspot.gserviceaccount.com"
  }

  swarming {
    hostname: "chromium-swarm-dev.appspot.com"
    builder_defaults {
      swarming_tags: "vpython:native-python-wrapper"
      dimensions: "pool:Chrome"  # No point in creating a dedicated pool on -dev.
      execution_timeout_secs: 1800  # 30 min
      build_numbers: YES
      recipe {
        name: "infra_continuous"
        cipd_package: "infra/recipe_bundles/chromium.googlesource.com/infra/infra"
        cipd_version: "refs/heads/master"
      }
      service_account: "adhoc-testing@luci-token-server-dev.iam.gserviceaccount.com"
    }

    builders {
      name: "infra-continuous-trusty-64"
      mixins: "infra-ci"
      dimensions: "os:Ubuntu-14.04"
    }

    builders {
      name: "infra-continuous-win-64"
      mixins: "infra-ci"
      dimensions: "os:Windows-7-SP1"
    }

    builders {
      name: "infra-continuous-win10-64"
      mixins: "infra-ci"
      dimensions: "os:Windows-10"
    }

    builders {
      name: "goma-hello-world-trusty-64"
      dimensions: "os:Ubuntu-14.04"
      dimensions: "cpu:x86-64"
      recipe {
        name: "goma_hello_world"
      }
    }

    builders {
      name: "gerrit-hello-world-trusty-64"
      dimensions: "os:Ubuntu-14.04"
      dimensions: "cpu:x86-64"
      recipe {
        name: "gerrit_hello_world"
      }
    }

    builders {
      name: "gsutil-hello-world-trusty-64"
      dimensions: "os:Ubuntu-14.04"
      dimensions: "cpu:x86-64"
      recipe {
        name: "gsutil_hello_world"
      }
    }

    builders {
      name: "gsutil-hello-world-win10-64"
      dimensions: "os:Windows-10"
      dimensions: "cpu:x86-64"
      recipe {
        name: "gsutil_hello_world"
      }
    }
    builders {
      name: "infra-continuous-pack-apps"
      dimensions: "docker_installed:true"
      dimensions: "os:Ubuntu"
      dimensions: "cpu:x86-64"
      recipe {
        name: "run_docker"
        cipd_package: "infra/recipe_bundles/chromium.googlesource.com/chromium/tools/build"
        properties_j: <<END
          cmd_args:[
            "apack",
            "pack",
            "source/infra/appengine/cr-buildbucket/default.apack"
          ]
        END
        properties: "image:infra_dev_env"
        properties_j: "inherit_luci_context:true"
      }
    }
  }
}
