<!DOCTYPE html>
<head>
  <title>Try Job Dashboard</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="/common.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script>
    function createUrl(parameters) {
      var params = [];
      for (var key in parameters) {
        if (parameters[key] != undefined) {
          params.push(key + '=' + parameters[key])
        }
      }

      if (params.length == 0) {
        return 'try-job-dashboard';
      } else {
        return 'try-job-dashboard?' + params.join('&');
      }
    };

    function requestDataBetweenDateRange(e) {
      var parameters = {}
      parameters['start_date'] = $('#start_date').val() == 'mm/dd/yyyy' ? undefined : $('#start_date').val();
      parameters['end_date'] = $('#end_date').val() == 'mm/dd/yyyy' ? undefined : $('#end_date').val();
      newUrl = createUrl(parameters);
      window.location.replace(newUrl);
      e.preventDefault();
    };

    $(document).ready(function() {
      $('#submit').click(requestDataBetweenDateRange);
    });
  </script>
</head>
<body>
  <form>
    Start Date
    <input type="date" id="start_date" value={{ start_date }}></input>
    End Date
    <input type="date" id="end_date" value={{ end_date }}></input>
    <input type="submit" id="submit"></input>
  </form>
  <br>
  <b>In progress</b>
  <div>
    {% if try_jobs_in_progress %}
      <table>
        <tr>
          <th>Master</th>
          <th>Builder</th>
          <th>Build #</th>
          <th>Try Job Type</th>
          <th>Request Time</th>
          <th>Start Time</th>
          <th>Elapsed Time</th>
          <th>Status</th>
          <th>Try Job URL</th>
        </tr>
        <tbody>
          {% for try_job_display_data in try_jobs_in_progress %}
            <tr>
              <td>{{ try_job_display_data.master_name }}</td>
              <td>{{ try_job_display_data.builder_name }}</td>
              <td>
                <a href="/waterfall/build-failure?url=https://build.chromium.org/p
/{{try_job_display_data.master_name}}/builders/{{try_job_display_data.builder_name}}
/builds/{{try_job_display_data.build_number}}" target="_blank">{{try_job_display_data.build_number}}
                </a>
              </td>
              <td>{{ try_job_display_data.try_job_type }}</td>
              <td>{{ try_job_display_data.request_time }}</td>
              <td>{{ try_job_display_data.start_time }}</td>
              <td>{{ try_job_display_data.elapsed_time }}</td>
              <td>{{ try_job_display_data.status }}</td>
              <td>
                {% if try_job_display_data.try_job_url %}
                  <a href="{{ try_job_display_data.try_job_url }}" target="_blank">link</a>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
      </tbody>
    </table>
    {% else %}
      No try-jobs currently in progress withinin the date range requested
    {% endif %}
  </div>
  <br>
  <b>Try jobs with error</b>
  <div>
    {% if try_jobs_with_error %}
      <table>
        <tr>
          <th>Master</th>
          <th>Builder</th>
          <th>Build #</th>
          <th>Try Job Type</th>
          <th>Request Time</th>
          <th>Start Time</th>
          <th>End Time</th>
          <th>Error Message</th>
          <th>Try Job URL</th>
        </tr>
        <tbody>
          {% for try_job_display_data in try_jobs_with_error %}
            <tr>
              <td>{{ try_job_display_data.master_name }}</td>
              <td>{{ try_job_display_data.builder_name }}</td>
              <td>
                <a href="/waterfall/build-failure?url=https://build.chromium.org/p
/{{try_job_display_data.master_name}}/builders/{{try_job_display_data.builder_name}}
/builds/{{try_job_display_data.build_number}}" target="_blank">{{try_job_display_data.build_number}}
                </a>
              </td>
              <td>{{ try_job_display_data.try_job_type }}</td>
              <td>{{ try_job_display_data.request_time }}</td>
              <td>{{ try_job_display_data.start_time }}</td>
              <td>{{ try_job_display_data.end_time }}</td>
              <td>{{ try_job_display_data.error }}</td>
              <td>
                {% if try_job_display_data.try_job_url %}
                  <a href="{{ try_job_display_data.try_job_url }}" target="_blank">link</a>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      No try-jobs were detected to have errors within the date range requested
    {% endif %}
  </div>
  <br>
  <b>Completed</b>
  <div>
    {% if successfully_completed_try_jobs %}
      <table>
        <tr>
          <th>Master</th>
          <th>Builder</th>
          <th>Build #</th>
          <th>Try Job Type</th>
          <th>Request Time</th>
          <th>Start Time</th>
          <th>End Time</th>
          <th>Culprit Found</th>
          <th>Try Job URL</th>
        </tr>
        <tbody>
          {% for try_job_display_data in successfully_completed_try_jobs %}
            <tr>
              <td>{{ try_job_display_data.master_name }}</td>
              <td>{{ try_job_display_data.builder_name }}</td>
              <td>
                <a href="/waterfall/build-failure?url=https://build.chromium.org/p
/{{try_job_display_data.master_name}}/builders/{{try_job_display_data.builder_name}}
/builds/{{try_job_display_data.build_number}}" target="_blank">{{try_job_display_data.build_number}}
                </a>
              </td>
              <td>{{ try_job_display_data.try_job_type }}</td>
              <td>{{ try_job_display_data.request_time }}</td>
              <td>{{ try_job_display_data.start_time }}</td>
              <td>{{ try_job_display_data.end_time }}</td>
              <td>{{ try_job_display_data.culprit_found }}</td>
              <td>
                {% if try_job_display_data.try_job_url %}
                  <a href="{{ try_job_display_data.try_job_url }}" target="_blank">link</a>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      No try-jobs have completed within the time range requested
    {% endif %}
  </div>
</body>
