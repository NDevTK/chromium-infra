<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/chopsui/chops-dialog.html">
<link rel="import" href="../../../bower_components/chopsui/chops-timestamp.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">

<link rel="import" href="../../mr-user-link/mr-user-link.html">
<link rel="import" href="./mr-edit-metadata.html">
<link rel="import" href="./mr-metadata.html">
<link rel="import" href="../shared/mr-flt-styles.html">
<link rel="import" href="../../mixins/redux-mixin.html">

<dom-module id="mr-issue-metadata">
  <template>
    <style include="mr-flt-styles">
      :host {
        box-sizing: border-box;
        padding: 0.5em 8px;
        max-width: 100%;
        display: block;
        position: sticky;
        top: 0.5em;
      }
      a.label {
        color: hsl(120, 100%, 25%);
        text-decoration: none;
      }
      a.label[data-derived] {
        font-style: italic;
      }
      chops-button {
        border: 1px solid hsl(120, 15%, 90%);
      }
      mr-edit-metadata {
        width: 800px;
        max-width: 100%;
      }
      .dialog-actions {
        text-align: right;
      }
      .edit-container {
        text-align: center;
        box-sizing: border-box;
        padding: 0.5em 8px;
        border-top: 1px solid hsl(120, 15%, 90%);
      }
      .restricted {
        background: hsl(30, 100%, 93%);
        border: 1px solid hsl(30, 40%, 85%);
        width: 100%;
        box-sizing: border-box;
        padding: 0.5em 8px;
        margin: 1em auto;
      }
      .restricted iron-icon {
        --iron-icon-fill-color: hsl(30, 5%, 39%);
      }
      .restricted strong {
        display: block;
        text-align: center;
        width: 100%;
        margin-bottom: 0.5em;
      }
      .star-line {
        width: 100%;
        text-align: center;
        --iron-icon-fill-color: hsl(120, 5%, 66%);
      }
    </style>
    <div class="star-line">
      <template is="dom-if" if="[[isStarred]]">
        <iron-icon icon="star" title="You've starred this issue"></iron-icon>
      </template>
      <template is="dom-if" if="[[!isStarred]]">
        <iron-icon icon="star-border" title="Click to star this issue"></iron-icon>
      </template>
      Starred by [[issue.starCount]] users
    </div>
    <mr-metadata
      owner="[[issue.ownerRef]]"
      cc="[[issue.ccRefs]]"
      issue-status="[[issue.statusRef]]"
      components="[[issue.componentRefs]]"
      fields="[[_fields]]"
      blocked-on="[[issue.blockedOnIssueRefs]]"
      blocking="[[issue.blockingIssueRefs]]"
      modified-timestamp="[[issue.modifiedTimestamp]]"
    ></mr-metadata>

    <div class="labels-container">
      <template is="dom-repeat" items="[[issue.labelRefs]]" as="label">
        <a href$="/p/[[item.projectName]]/issues/list?q=label:[[label.label]]" class="label" data-derived$="[[label.isDerived]]">[[label.label]]</a>
        <br />
      </template>
    </div>
    <div class="restricted">
      <strong><iron-icon icon="lock"></iron-icon>Restricted</strong>
      Only users with Google permission can see this issue.
    </div>

    <div class="edit-container">
      <chops-button on-click="edit">
        <iron-icon icon="create"></iron-icon>
        Edit feature metadata
      </chops-button>
    </div>

    <chops-dialog id="editMetadata" aria-labelledby="metadataDialogTitle">
      <h3 id="metadataDialogTitle">
        Editing feature details
      </h3>
      <mr-edit-metadata
        id="metadataForm"
        issue="[[issue]]"
        cc="[[issue.ccRefs]]"
        components="[[issue.componentRefs]]"
        project-name="[[issue.projectName]]"
        statuses="[[statuses]]"
        status="[[issue.statusRef.status]]"
        summary="[[issue.summary]]"
        blocked-on="[[issue.blockedOnIssueRefs]]"
        blocking="[[issue.blockingIssueRefs]]"
        labels="[[issue.labelRefs]]"
      ></mr-edit-metadata>
      <div class="dialog-actions">
        <chops-button on-click="cancel" class="de-emphasized">
          <iron-icon icon="close"></iron-icon>
          Cancel
        </chops-button>
        <chops-button on-click="save" class="emphasized">
          <iron-icon icon="create"></iron-icon>
          Save changes
        </chops-button>
      </div>
    </chops-dialog>
  </template>
  <script src="./mr-issue-metadata.js"></script>
<dom-module>
