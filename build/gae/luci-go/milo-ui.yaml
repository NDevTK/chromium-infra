name: luci-go/milo-ui
extends: ../base.yaml

inputsdir: ../../../go/src/go.chromium.org/luci/milo

build:
  # This builds the frontend code updating ${inputsdir}/frontend/resultui/out.
  - run: ['make', 'release']
    cwd: ${inputsdir}/frontend/resultui

  # This packages all Go code with its dependencies into _gopath/src/....
  - go_gae_bundle: ${inputsdir}/frontend/resultui/service-resultui.yaml
    dest: ${contextdir}/frontend/resultui

  # This adds the build result of the first step to a directory where
  # frontend/resultui actually resides in the tarball. _gopath is unfortunately
  # a leaking implementation detail of how Go GAE apps are bundled.
  - copy: ${inputsdir}/frontend/resultui/out
    dest: ${contextdir}/_gopath/src/go.chromium.org/luci/milo/frontend/resultui/out
