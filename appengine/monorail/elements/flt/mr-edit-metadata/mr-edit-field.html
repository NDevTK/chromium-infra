<link rel="import" href="../../../bower_components/chopsui/chops-button.html">
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../shared/field-types.html">
<link rel="import" href="../shared/flt-helpers.html">
<link rel="import" href="../shared/mr-flt-styles.html">

<dom-module id="mr-edit-field">
  <template>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
          rel="stylesheet">
    <style include="mr-flt-styles">
      :host {
        display: block;
      }
      :host([hidden]) {
        display: none;
      }
      input,
      select {
        @apply --mr-edit-field-styles;
      }
      input[type="checkbox"] {
        width: auto;
        height: auto;
      }
      .derived {
        font-style: italic;
        color: #222;
      }
      .multi-grid {
        width: 95%;
        display: grid;
        grid-column-gap: 1%;
        grid-row-gap: 3px;
        grid-template-columns: 24% 24% 24% 25%;
      }
      .user-multi-grid {
        width: 95%;
        display: grid;
        grid-column-gap: 1%;
        grid-row-gap: 3px;
        grid-template-columns: 32% 33% 33%;
      }
    </style>
    <template is="dom-if" if="[[_fieldIsEnum(type)]]">
      <template is="dom-if" if="[[multi]]">
        <template is="dom-repeat" items="[[options]]" as="option">
          <label title$="[[option.docstring]]">
            <input
              class="enum-input"
              type="checkbox"
              name$="[[name]]"
              value$="[[option.optionName]]"
              checked$="[[_optionInValues(initialValues, option.optionName)]]"
            />
            [[option.optionName]]
          </label>
        </template>
      </template>
      <select id="editSelect" hidden$="[[multi]]">
        <option value="">----</option>
        <template is="dom-repeat" items="[[options]]" as="option">
          <option
            value$="[[option.optionName]]"
            selected$="[[_computeIsSelected(_initialValue, option.optionName)]]"
          >
            [[option.optionName]]
            <template is="dom-if" if="[[option.docstring]]">
              - [[option.docstring]]
            </template>
          </option>
        </template>
      </select>
    </template>

    <template is="dom-if" if="[[_fieldIsBasic]]">
      <template is="dom-if" if="[[multi]]">
        <div id="multi-grid" class$="[[_multiGridClass]]">
          <template is="dom-repeat" items="[[derivedValues]]">
            <div class="derived" title$="Derived: [[item]]">
              [[item]]
            </div>
          </template>
          <template is="dom-repeat" items="[[_multiInputs]]">
            <input
              id$="multi[[index]]"
              class="multi"
              aria-label$="[[name]] input #[[index]]"
              value$="[[item]]"
              data-ac-type$="[[_acType]]"
              autocomplete$="[[_computeDomAutocomplete(_acType)]]"
              style="width: unset"
            />
          </template>
        </div>
        <chops-button on-click="_addEntry" class="de-emphasized">
          <i class="material-icons">add</i>
          Add entry
        </chops-button>
      </template>
      <input
        id="editInput"
        hidden$="[[multi]]"
        value$="[[_initialValue]]"
        data-ac-type$="[[_acType]]"
        autocomplete$="[[_computeDomAutocomplete(_acType)]]"
      />
    </template>
  </template>
  <script src="./mr-edit-field.js"></script>
<dom-module>
