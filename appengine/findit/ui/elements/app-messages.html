<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/paper-dialog/paper-dialog.html">

<dom-module id="app-messages">
  <template>
    <style>
       .message {
         background-color: #1F78B4;
         color: #fff;
         min-width: 500px;
         max-width: 800px;
         min-height: 100px;
         max-height: 300px;
       }
    </style>

    <paper-dialog id="dialog" class="message">
      <template is="dom-if" if="[[_IsPredefinedMessageCode(_message, 100)]]">
        <div>
          Please log in with your @google.com account first to schedule an analysis or give feedback on the analysis result. <br>
          If already logged in, please try refreshing the page for a new XSRF token which expires in one hour.
          <br>
          <br>
          Meanwhile, all previous analyses are public and searchable.
          <br>
        </div>
      </template>
      <template is="dom-if" if="[[_IsPredefinedMessageCode(_message, 200)]]">
        <div title="Score Explanation">
          The total score is a sum of scores for all hints.<br>
          Rules to set a score to an hint:
          <ul>
            <li>5: The CL added or deleted a file that appears in the failure log.</li>
            <li>4: The CL modified a line of a file and that line appears in the failure log.</li>
            <li>2: The CL modified a file that appears in the failure log.</li>
            <li>1: The CL modified a file that is related to another file
                   appearing in the failure log. (eg: file.h was changed and
                   file_unittest.cc or file_impl.cc appeared in the log.)</li>
            <li>1: The CL rolled a dependency within src/DEPS and a file of that
                   dependency appears in the failure log. (eg: third_party/dep
                   was changed in src/DEPS and third_party/dep/f.cpp appeared
                   in the log.)</li>
          </ul>
          (More rules will be added when implemented.)
        </div>
      </template>
      <template is="dom-if" if="[[_IsUndefinedMessageCode(_message)]]">
        <div style="text-align: center">
          [[_message.text]]
        </div>
      </template>
    </paper-dialog>
  </template>

  <script>
   (function() {
     'use strict';

     Polymer({
       is: 'app-messages',

       ready: function() {
         document.addEventListener('message', function(e) {
           console.log('Received one message event.');
           console.log(e);
           this.$.dialog.close();
           this._message = e.detail;
           this.$.dialog.open();
         }.bind(this));
       },

       properties: {
         _message: {
           type: Object,
           value:undefined,
         },
       },

       _IsPredefinedMessageCode: function(message, code) {
         return Boolean(message && message.predefined_code == code);
       },

       _IsUndefinedMessageCode: function(message) {
         return Boolean(message && (message.predefined_code == undefined || message.predefined_code == null));
       },
     });
   })();
  </script>
</dom-module>
