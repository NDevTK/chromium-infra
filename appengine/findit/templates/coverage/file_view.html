<!DOCTYPE html>
<head>
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <title>Coverage for {{project}} - {{path}}</title>
  <meta charset="utf-8">
  <style>
    .coverage-header {
      padding: 5px 10px;
      border-bottom: 1px solid #DBDBDB;
      background-color: #EEE;
      line-height: 24px;
      text-align: center;
      font-weight: bold;
      font-size: 18px;
    }
    table {
      border-collapse: collapse;
      border: 1px solid #EEE;
      font-family: -apple-system, sans-serif;
    }
    td {
      vertical-align: top;
      padding: 2px 8px;
      border-collapse: collapse;
      border-right: solid 1px #EEE;
      border-left: solid 1px #EEE;
      text-align: left;
    }
    tbody td {
      height: 18px;
    }
    td pre {
      margin-top: 0px !important;
      margin-bottom: 0px !important;
      display: inline-block;
      font-family: monospace;
      height: 15px;
    }
    td:first-child {
      border-left: none;
    }
    td:last-child {
      border-right: none;
    }
    thead a:hover {
      background-color: yellow;
    }
    .highlight-row:hover {
      background-color: #F0F0F0;
    }
    .covered-code {
      background-color: #E3F1F1;
    }
    .uncovered-code {
      background-color: #F8D2AA;
    }
    .partially-covered-code {
      background: linear-gradient(to right bottom, #E3F1F1 50%, #F8D2AA 50%);
    }
    .covered-count {
      color: BLUE;
      text-align: right;
    }
    .uncovered-count {
      color: DARKORANGE;
      text-align: right;
    }
    .partial-count {
      color: FUCHSIA;
      text-align: right;
    }
  </style>
  <script src="/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="/ui/elements/cats-app.html">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script>
    $(function() {
      document.getElementById('app').userInfo = {{ (user_info or {}) | tojson | safe }};
    });
  </script>
</head>

{% macro HumanReadableCount(count) -%}
  {%- if count >= 1000000000000 -%}
    {{'{0:.1f}'.format(count/1000000000000.0)}}T
  {%- elif count >= 1000000000 -%}
    {{'{0:.1f}'.format(count/1000000000.0)}}G
  {%- elif count >= 1000000 -%}
    {{'{0:.1f}'.format(count/1000000.0)}}M
  {%- elif count >= 1000 -%}
    {{'{0:.1f}'.format(count/1000.0)}}K
  {%- else -%}
    {{count}}
  {%- endif %}
{%- endmacro %}

<body>
  <cats-app id="app" components="Tools>CodeCoverage" page-header="Code Coverage: line-by-line coverage (Chrome Browser for {{platform_ui_name}})">
    <div style="font-size:18px">
    Switch to <a href="/p/chromium/coverage/component?host={{host}}&project={{project}}&ref={{ref}}&revision={{revision}}&path=>>&platform={{platform}}">Component View</a>
    <br>
    <br>
    </div>
    <table>
      <thead>
        <tr class="coverage-header">
          <th colspan="3">
            <a href="/p/chromium/coverage?host={{host}}&project={{project}}&platform={{platform}}">{{project}}</a>
            - {{data.commit_position or revision}}
            - <a href="/p/chromium/coverage?host={{host}}&project={{project}}&ref={{ref}}&revision={{revision}}&path={{path_root}}&platform={{platform}}">{{path_root}}</a>{% for name, sub_path in path_parts %}<a style="padding-left:.3ex;" title="{{sub_path}}" href="/p/chromium/coverage/{{'dir' if name.endswith('/') else 'file'}}?host={{host}}&project={{project}}&ref={{ref}}&revision={{revision}}&path={{sub_path}}&platform={{platform}}">{{name}}</a>{% endfor %}
          </th>
        </tr>
        <tr>
          <th>Line</th>
          <th>Count</th>
          <th>Source Code</th>
        </tr>
      </thead>

      <tbody id="report-data-container">
      {% for num, info in data.line_to_data %}
        <tr id="{{num}}" class="highlight-row">
          {% if info.count == 0 %}
            <td class="uncovered-code" title="Uncovered line"><a href="#{{num}}"><pre>{{num}}</pre></a></td>
            <td class="uncovered-count"><pre>0</pre></td>
            <td ><pre class="uncovered-code" title="Uncovered code">{{info.line}}</pre></td>
          {% elif info.is_partially_covered %}
            <td class="partially-covered-code" title="Partially covered line"><a href="#{{num}}"><pre>{{num}}</pre></a></td>
            <td class="partial-count" title="{{info.count}}">
                <pre>{{HumanReadableCount(info.count)}}</pre>
            </td>
            <td>
              <pre>
                {%- for region in info.regions -%}
                  {%- if region.is_covered -%}
                    <span>{{region.text}}</span>
                  {%- else -%}
                    <span class="uncovered-code" title="Uncovered code">{{region.text}}</span>
                  {%- endif -%}
                {%- endfor -%}
              </pre>
            </td>
          {% elif info.count > 0 %}
            <td class="covered-code" title="Covered line"><a href="#{{num}}"><pre>{{num}}</pre></a></td>
            <td class="covered-count" title="{{info.count}}">
              <pre>{{HumanReadableCount(info.count)}}</pre>
            </td>
            <td><pre>{{info.line}}</pre></td>
          {% else %}
            <td><a href="#{{num}}"><pre>{{num}}</pre></a></td>
            <td><!-- Intentionally empty. Count would go here. --></td>
            <td><pre>{{info.line}}</pre></td>
          {% endif %}
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </cats-app>
</body>
